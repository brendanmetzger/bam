#!/usr/bin/php
<?php

chdir(dirname(__FILE__).'/..');

define('CONF', parse_ini_file('data/config.ini'));

require 'src/kernel.php';



/*** ROUTING **************************************************************************************/



Route::markdown(function($input = null) {
  chdir('views');
  $template = new Template(Document::open('pages/index.html'));
  
  return Render::DOM($template->render());
});



/*** IMPLEMENTATION *******************************************************************************/



try {
  
  $command = new Command(array_slice($argv,1));
  $output  = Route::compose($command);
  
} catch (Exception | Error $e) {
  
  $output  = sprintf("\n\033[0;31m%s\033[0m\n", $e->getMessage());
  $output .= sprintf("line %s in %s\n", $e->getLine(), $e->getFile());
  
} finally {

  echo $output;
  echo "\n- Finished {$command->action} -\n";
  exit($command->status);
  
}


